@using DIGESA.Models.CannabisModels
@using DIGESA.Models.Entities.DBDIGESA
<h3>Solicitud</h3>

<EditForm Model="paciente" OnValidSubmit="RegisterForm">
    <DataAnnotationsValidator/>
    <ValidationSummary Class="alert alert-danger mb-3"/>
    <label>Primer Nombre</label>
    <InputText @bind-Value="paciente.PrimerNombre"/>
    <ValidationMessage For="@(() => paciente.PrimerNombre)"/>
    
    <label>Segundo Nombre</label>
    <InputText @bind-Value="paciente.SegundoNombre"/>
    <ValidationMessage For="@(() => paciente.SegundoNombre)"/>
    
    <label>Primer Apellido</label>
    <InputText @bind-Value="paciente.PrimerApellido"/>
    <ValidationMessage For="@(() => paciente.PrimerApellido)"/>
    
    <label>Segundo Apellido</label>
    <InputText @bind-Value="paciente.SegundoApellido"/>
    <ValidationMessage For="@(() => paciente.SegundoApellido)"/>
    
    <label>Tipo de Documento</label>
    <InputRadioGroup @bind-Value="@paciente.TipoDocumentoPacienteEnum" class="d-flex gap-3">
        <div class="form-check">
            <InputRadio class="form-check-input" Value="TipoDocumentoPaciente.Cedula" id="Cedula"/>
            <label class="form-check-label" for="Cedula">Cedula</label>
        </div>
        <div class="form-check">
            <InputRadio class="form-check-input" Value="TipoDocumentoPaciente.Pasaporte" id="Pasaporte"/>
            <label class="form-check-label" for="Pasaporte">Pasaporte</label>
        </div>
    </InputRadioGroup>
    @if (paciente.TipoDocumentoPacienteEnum == TipoDocumentoPaciente.Cedula)
    {
        <div class="mt-2">
            <label for="cedula">Número de Cédula</label>
            <InputText id="cedula" class="form-control" @bind-Value="paciente.NumDocCedula" />
            <ValidationMessage For="@(() => paciente.NumDocCedula)" />
        </div>
    }
    else if (paciente.TipoDocumentoPacienteEnum == TipoDocumentoPaciente.Pasaporte)
    {
        <div class="mt-2">
            <label for="pasaporte">Número de Pasaporte</label>
            <InputText id="pasaporte" class="form-control" @bind-Value="paciente.NumDocPasaporte" />
            <ValidationMessage For="@(() => paciente.NumDocPasaporte)" />
        </div>
    }
    <label>Nacionalidad</label>
    <InputText @bind-Value="paciente.Nacionalidad" class="form-control"/>
    <ValidationMessage For="@(() => paciente.Nacionalidad)"/>
    
    <label>Fecha de Nacimiento</label>
    <InputDate @bind-Value="paciente.FechaNacimiento" class="form-control"/>
    <ValidationMessage For="@(() => paciente.FechaNacimiento)"/>
    
    <label class="form-label">Sexo</label>
    <input type="hidden" name="SexoEnum" @bind="paciente.SexoEnum" />

    <div class="form-check">
        <input type="checkbox"
               class="form-check-input"
               id="chkMasculino"
               checked="@(paciente.SexoEnum == Sexo.Masculino)"
               @onchange="() => paciente.SexoEnum = Sexo.Masculino" />
        <label class="form-check-label" for="chkMasculino">Masculino</label>
    </div>
    <div class="form-check">
        <input type="checkbox"
               class="form-check-input"
               id="chkFemenino"
               checked="@(paciente.SexoEnum == Sexo.Femenino)"
               @onchange="() => paciente.SexoEnum = Sexo.Femenino" />
        <label class="form-check-label" for="chkFemenino">Femenino</label>
    </div>
    
    <!-- Fixed Provincia InputSelect with nullable int -->
    <label class="form-label">Provincia</label>
    <InputSelect TValue="int?" class="form-select form-select-sm"
                 Value="@paciente.pacienteProvinciaId"
                 ValueChanged="@(async (int? ProvinciaId) => await pacienteProvinciaChanged(ProvinciaId ?? 0))"
                 ValueExpression="@(() => paciente.pacienteProvinciaId)">
        <option value="">--Seleccione--</option>
        @foreach (var x in pacienteProvincicaslist)
        {
            <option value="@x.Id">@x.Name</option>
        }
    </InputSelect>
    <ValidationMessage For="@(() => paciente.pacienteProvinciaId)" class="text-danger"/>

    <!-- Fixed Distrito InputSelect with nullable int -->
    <label class="form-label">Distrito</label>
    <InputSelect TValue="int?" class="form-select form-select-sm"
                 Value="@paciente.pacienteDistritoId"
                 ValueChanged="@(async (int? DistritoId) => await pacienteDistritoChanged(DistritoId ?? 0))"
                 ValueExpression="@(() => paciente.pacienteDistritoId)">
        <option value="">--Seleccione--</option>
        @foreach (var x in pacienteDistritolist)
        {
            <option value="@x.Id">@x.Name</option>
        }
    </InputSelect>
    <ValidationMessage For="@(() => paciente.pacienteDistritoId)" class="text-danger"/>

    
    <label class="form-label">Corregimiento</label>
    <InputSelect TValue="int?" class="form-select form-select-sm"
                 @bind-Value="@paciente.pacienteCorregimientoId">
        <option value="">--Seleccione--</option>
        @foreach (var x in pacienteCorregimientolist)
        {
            <option value="@x.Id">@x.Name</option>
        }
    </InputSelect>
    <ValidationMessage For="@(() => paciente.pacienteCorregimientoId)" class="text-danger"/>
    
    <label class="form-label">Dirección</label>
    <InputTextArea @bind-Value="paciente.DireccionExacta" class="form-control"/> 
    <ValidationMessage For="@(() => paciente.DireccionExacta)" />
    
    <label class="form-label">Número de teléfono personal</label>
    <InputText @bind-Value="paciente.TelefonoPersonal" class="form-control" />
    <ValidationMessage For="@(() => paciente.TelefonoPersonal)" />
    
    <label class="form-label">Número de teléfono residencia</label>
    <InputText @bind-Value="paciente.TelefonoResidencial" class="form-control" />
    <ValidationMessage For="@(() => paciente.TelefonoResidencial)" />
    
    <label class="form-label">Número de teléfono laboral</label>
    <InputText @bind-Value="paciente.TelefonoLaboral" class="form-control" />
    <ValidationMessage For="@(() => paciente.TelefonoLaboral)" />
    
    <label class="form-label">Correo electrónico</label>
    <InputText @bind-Value="paciente.CorreoElectronico" class="form-control" />
    <ValidationMessage For="@(() => paciente.CorreoElectronico)" />
    
    <div class="col-12 col-sm-6 mb-3">
        <label class="fw-bold">Instalación de salud donde es atendido</label>
        <AutoComplete @bind-Value="instalacionFilter"
                      TItem="ListModel"
                      DataProvider="AutoCompleteDataProvider"
                      OnChanged="(ListModel sel) => OnAutoCompleteChanged(sel)"
                      PropertyName="Name"
                      class="form-control"
                      Placeholder="Busque por instalación de salud" />
        <ValidationMessage For="@(() => paciente.pacienteInstalacionId)" class="text-danger" />
    </div>
    
    <label class="form-label">Region de salud de salud donde es atendido</label>
    <InputSelect TValue="int?" class="form-select form-select-sm"
                 @bind-Value="@paciente.pacienteRegionId">
        <option value="">--Seleccione--</option>
        @foreach (var x in pacienteRegioneslist)
        {
            <option value="@x.Id">@x.Name</option>
        }
    </InputSelect>
    <ValidationMessage For="@(() => paciente.pacienteRegionId)" class="text-danger"/>
    
    <label class="form-label fw-bold">¿Requiere acompañante?</label>
    <InputRadioGroup @bind-Value="paciente.RequiereAcompanante" class="d-flex gap-3 mb-3">
        <div class="form-check form-check-inline">
            <InputRadio class="form-check-input" Value="RequiereAcompanante.Si" id="reqSi" />
            <label class="form-check-label" for="reqSi">Sí</label>
        </div>
        <div class="form-check form-check-inline">
            <InputRadio class="form-check-input" Value="RequiereAcompanante.No" id="reqNo" />
            <label class="form-check-label" for="reqNo">No</label>
        </div>
    </InputRadioGroup>
    <ValidationMessage For="@(() => paciente.RequiereAcompanante)" />

    @if (paciente.RequiereAcompanante == RequiereAcompanante.Si)
    {
        <div class="mt-3">
            <label class="form-label">Motivo</label>
            <InputRadioGroup @bind-Value="paciente.MotivoRequerimientoAcompanante" class="d-flex gap-3">
                <div class="form-check form-check-inline">
                    <InputRadio class="form-check-input"
                                Value="@MotivoRequerimientoAcompanante.PacienteDiscapacidad"
                                id="motivoDiscapacidad" />
                    <label class="form-check-label" for="motivoDiscapacidad">Discapacidad</label>
                </div>
                <div class="form-check form-check-inline">
                    <InputRadio class="form-check-input"
                                Value="@MotivoRequerimientoAcompanante.PacienteMenorEdad"
                                id="motivoMenorEdad" />
                    <label class="form-check-label" for="motivoMenorEdad">Menor de edad</label>
                </div>
            </InputRadioGroup>
            <ValidationMessage For="@(() => paciente.MotivoRequerimientoAcompanante)" />
        </div>

        @if (paciente.MotivoRequerimientoAcompanante == MotivoRequerimientoAcompanante.PacienteDiscapacidad)
        {
            <div class="mt-3">
                <label for="TipoDiscapacidad" class="form-label">Describe el tipo de discapacidad</label>
                <InputText id="TipoDiscapacidad"
                           class="form-control"
                           @bind-Value="paciente.TipoDiscapacidad" />
                <ValidationMessage For="@(() => paciente.TipoDiscapacidad)" />
            </div>
        }

        <!-- Datos del acompañante -->
        <div class="mt-4">
            <label>Primer Nombre</label>
            <InputText @bind-Value="acompañante.PrimerNombre" class="form-control" />
            <ValidationMessage For="@(() => acompañante.PrimerNombre)" />

            <label>Segundo Nombre</label>
            <InputText @bind-Value="acompañante.SegundoNombre" class="form-control" />
            <ValidationMessage For="@(() => acompañante.SegundoNombre)" />

            <label>Primer Apellido</label>
            <InputText @bind-Value="acompañante.PrimerApellido" class="form-control" />
            <ValidationMessage For="@(() => acompañante.PrimerApellido)" />

            <label>Segundo Apellido</label>
            <InputText @bind-Value="acompañante.SegundoApellido" class="form-control" />
            <ValidationMessage For="@(() => acompañante.SegundoApellido)" />

            <label>Tipo de Documento</label>
            <InputRadioGroup @bind-Value="acompañante.TipoDocumentoAcompañanteEnum" class="d-flex gap-3">
                <div class="form-check">
                    <InputRadio class="form-check-input" Value="TipoDocumentoAcompañante.Cedula" id="Cedula" />
                    <label class="form-check-label" for="Cedula">Cédula</label>
                </div>
                <div class="form-check">
                    <InputRadio class="form-check-input" Value="TipoDocumentoAcompañante.Pasaporte" id="Pasaporte" />
                    <label class="form-check-label" for="Pasaporte">Pasaporte</label>
                </div>
            </InputRadioGroup>

            @if (acompañante.TipoDocumentoAcompañanteEnum == TipoDocumentoAcompañante.Cedula)
            {
                <div class="mt-2">
                    <label for="cedula">Número de Cédula</label>
                    <InputText id="cedula" class="form-control" @bind-Value="acompañante.NumDocCedula" />
                    <ValidationMessage For="@(() => acompañante.NumDocCedula)" />
                </div>
            }
            else if (acompañante.TipoDocumentoAcompañanteEnum == TipoDocumentoAcompañante.Pasaporte)
            {
                <div class="mt-2">
                    <label for="pasaporte">Número de Pasaporte</label>
                    <InputText id="pasaporte" class="form-control" @bind-Value="acompañante.NumDocPasaporte" />
                    <ValidationMessage For="@(() => acompañante.NumDocPasaporte)" />
                </div>
            }

            <label>Nacionalidad</label>
            <InputText @bind-Value="acompañante.Nacionalidad" class="form-control" />
            <ValidationMessage For="@(() => acompañante.Nacionalidad)" />

            <label>Parentesco</label>
            <InputText @bind-Value="acompañante.Parentesco" class="form-control" />
            <ValidationMessage For="@(() => acompañante.Parentesco)" />
        </div>
    }
    

    <div class="mt-3">
    <button type="submit" class="btn btn-primary">Enviar Solicitud</button>
    </div>
</EditForm>
@code {
    
}